<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>cadmus documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">cadmus documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">












<ol class="breadcrumb">
  <li>Interfaces</li>
  <li>DatationModel</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>libs/core/src/lib/datation.ts</code>
        </p>

            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>Interface implemented by a single datation point in a historical date,
as returned from the server.</p>

            </p>


        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#day">day</a>
                                </li>
                                <li>
                                        <a href="#hint">hint</a>
                                </li>
                                <li>
                                        <a href="#isApproximate">isApproximate</a>
                                </li>
                                <li>
                                        <a href="#isCentury">isCentury</a>
                                </li>
                                <li>
                                        <a href="#isDubious">isDubious</a>
                                </li>
                                <li>
                                        <a href="#isSpan">isSpan</a>
                                </li>
                                <li>
                                        <a href="#month">month</a>
                                </li>
                                <li>
                                        <a href="#value">value</a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="day"></a>
                                        <span class="name"><b>day</b><a href="#day"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>day:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="hint"></a>
                                        <span class="name"><b>hint</b><a href="#hint"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>hint:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="isApproximate"></a>
                                        <span class="name"><b>isApproximate</b><a href="#isApproximate"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>isApproximate:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="isCentury"></a>
                                        <span class="name"><b>isCentury</b><a href="#isCentury"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>isCentury:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="isDubious"></a>
                                        <span class="name"><b>isDubious</b><a href="#isDubious"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>isDubious:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="isSpan"></a>
                                        <span class="name"><b>isSpan</b><a href="#isSpan"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>isSpan:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="month"></a>
                                        <span class="name"><b>month</b><a href="#month"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>month:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="value"></a>
                                        <span class="name"><b>value</b><a href="#value"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>value:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { RomanNumber } from &#x27;./roman-number&#x27;;

/**
 * Interface implemented by a single datation point in a historical date,
 * as returned from the server.
 */
export interface DatationModel {
  value: number;
  isCentury: boolean;
  isSpan: boolean;
  isApproximate: boolean;
  isDubious: boolean;
  day: number;
  month: number;
  hint: string;
}

/**
 * Options for formatting a datation.
 */
export interface DatationFormatOptions {
  aboutText: string;
  bcText: string;
  adText: string;
  dayNames: string[];
  monthNames: string[];
}

/**
 * Default options for formatting a datation.
 */
export const DATATION_FORMAT_OPTIONS: DatationFormatOptions &#x3D; {
  aboutText: &#x27;c.&#x27;,
  bcText: &#x27;BC&#x27;,
  adText: &#x27;AD&#x27;,
  dayNames: [
    &#x27;sun&#x27;, &#x27;mon&#x27;, &#x27;tue&#x27;, &#x27;wed&#x27;, &#x27;thu&#x27;, &#x27;fri&#x27;, &#x27;sat&#x27;
  ],
  monthNames: [
    &#x27;jan&#x27;, &#x27;feb&#x27;, &#x27;mar&#x27;, &#x27;apr&#x27;, &#x27;may&#x27;, &#x27;jun&#x27;, &#x27;jul&#x27;, &#x27;aug&#x27;, &#x27;sep&#x27;, &#x27;oct&#x27;, &#x27;nov&#x27;, &#x27;dec&#x27;
  ]
};

/**
 * Single datation point in a historical date.
 */
export class Datation implements DatationModel {
  public value: number;
  public isCentury: boolean;
  public isSpan: boolean;
  public isApproximate: boolean;
  public isDubious: boolean;
  public day: number;
  public month: number;
  public hint: string;

  /**
   * Create a new datation, optionally setting its data.
   * @param datation The optional data to be copied into the newly created datation.
   */
  constructor(datation: DatationModel &#x3D; null) {
    if (datation) {
      this.copyFrom(datation);
    }
  }

  /**
   * Sanitize the hint text representing a Datation&#x27;s hint so that it does not
   * include the reserved sequence -- (which gets replaced with Unicode EM
   * space U+2014), nor the braces. This is because the double dashes are used
   * to separate two datations, and braces to mark a hint in a datation.
   * Also, the whitespaces are all flattened to simple spaces, and normalized
   * (no whitespaces at start/end and no sequence of whitespaces).
   * If the resulting sanitized string is empty, or it was null when received,
   * null is returned.
   * @param hint The hint or null/undefined.
   * @returns The sanitized hint or undefined.
   */
  public static sanitizeHint(hint: string): string {
    if (!hint || !hint.trim()) {
      return undefined;
    }

    // replace reserved characters
    hint &#x3D; hint.replace(&#x27;--&#x27;, &#x27;\u2014&#x27;);
    hint &#x3D; hint.replace(&#x27;{&#x27;, &#x27;&#x27;);
    hint &#x3D; hint.replace(&#x27;}&#x27;, &#x27;&#x27;);

    // flatten and normalize whitespaces
    const s &#x3D; hint.replace(/\s+/g, &#x27; &#x27;).trim();
    return s ? s : undefined;
  }

  private static regexEscape(text: string): string {
    // https://stackoverflow.com/questions/3561493/is-there-a-regexp-escape-function-in-javascript
    return text.replace(/[-\/\\^$*+?.()|[\]{}]/g, &#x27;\\$&amp;&#x27;);
  }

  /**
   * Get BC and AD patterns for matching.
   * @param options The datation format options.
   */
  public static getErasOptionsForRegex(options: DatationFormatOptions
    &#x3D; DATATION_FORMAT_OPTIONS): string[] {
    return [
      options.bcText ? this.regexEscape(options.bcText) : &#x27;BC&#x27;,
      options.adText ? this.regexEscape(options.adText) : &#x27;AD&#x27;
    ]
  }

  private static getParserRegex(options: DatationFormatOptions): RegExp {
    const bcad &#x3D; this.getErasOptionsForRegex(options);

    return new RegExp(
      // about (1)
      &#x27;(c\\.)?\\s*&#x27; +
      // day (2)
      &#x27;(?:([0123]\\d?)\\s+)?&#x27; +
      // month (3)
      &#x27;(?:([a-zA-Z]{3,})\\s+)?&#x27; +
      // year/span (4,5)
      &#x27;(?:&#x27; +
      &#x27;(?:(\\d+)(?:\\s*/\\s*(\\d+))?)|&#x27; +
      // century (6)
      &#x27;([ivxIVX]+)&#x27; +
      &#x27;)\\s*&#x27; +
      // era (7)
      &#x27;(&#x27; + bcad[0] + &#x27;|&#x27; + bcad[1] + &#x27;)?&#x27; +
      // perhaps (8)
      &#x27;(\\s*\\?)?&#x27; +
      // hint (9)
      &#x27;(?:\\s*\\{([^}]+)\\})?&#x27;, &#x27;i&#x27;);
  }

  /**
   * Parse the specified text representing a datation.
   * @param text The text to be parsed.
   * @param options The formatter options.
   * @returns The parsed datation, or undefined if invalid or empty.
   * Note that here we return undefined to mean a non-existing point.
   * We do not want a non-existing point to be represented as a null,
   * as this would be included as in the JSON code when serializing.
   */
  public static parse(text: string,
    options: DatationFormatOptions &#x3D; DATATION_FORMAT_OPTIONS): Datation {
    if (!text) {
      return undefined;
    }
    const datation &#x3D; new Datation();
    const datationRegex &#x3D; this.getParserRegex(options);
    const m &#x3D; datationRegex.exec(text);
    if (!m) {
      return undefined;
    }

    // about
    if (m[1]) {
      datation.isApproximate &#x3D; true;
    }

    // day
    if (m[2]) {
      datation.day &#x3D; parseInt(m[2], 10);
    }

    // month
    if (m[3]) {
      const lowerMonth &#x3D; m[3].toLowerCase();
      const i &#x3D; options.monthNames.findIndex(name &#x3D;&gt;
        name.toLowerCase() &#x3D;&#x3D;&#x3D; lowerMonth);
      if (i &gt; -1) {
        datation.month &#x3D; i + 1;
      }
    }

    // year, span
    if (m[4]) {
      datation.value &#x3D; parseInt(m[4], 10);
      if (m[5]) {
        datation.isSpan &#x3D; true;
      }
    } else {
      datation.value &#x3D; RomanNumber.fromRoman(m[6].toUpperCase());
      datation.isCentury &#x3D; true;
    }

    // era
    if (m[7]) {
      const era &#x3D; m[7].replace(&#x27; &#x27;, &#x27;&#x27;).toLowerCase();
      if (era &#x3D;&#x3D;&#x3D; options.bcText.toLowerCase()) {
        datation.value &#x3D; -datation.value;
      }
    }

    // dubious
    if (m[8]) {
      datation.isDubious &#x3D; true;
    }

    // hint
    if (m[9]) {
      datation.hint &#x3D; Datation.sanitizeHint(m[9]);
    }

    return datation;
  }

  /**
   * Strip any era code from the specified datation format string.
   * @param format The format string.
   */
  public static stripFormatStringEra(format: string): string {
    if (!format) {
      return &#x27;i&#x27;;
    }

    // convert ga gp Ga Gp into simple g G
    format &#x3D; format.replace(new RegExp(&#x27;([gG])[ap]&#x27;, &#x27;gi&#x27;), &#x27;$1&#x27;);

    // replace g/G with i/I
    format &#x3D; format.replace(&#x27;g&#x27;, &#x27;i&#x27;);
    format &#x3D; format.replace(&#x27;G&#x27;, &#x27;I&#x27;);

    // remove ea ep Ea Ep with preceding w/W if any
    format &#x3D; format.replace(new RegExp(&#x27;[wW]?[eE][ap]?&#x27;, &#x27;gi&#x27;), &#x27;&#x27;);

    return format;
  }

  /**
   * Reset this datation.
   */
  public reset() {
    this.value &#x3D; 0;
    this.isCentury &#x3D; false;
    this.isSpan &#x3D; false;
    this.isApproximate &#x3D; false;
    this.day &#x3D; 0;
    this.month &#x3D; 0;
    this.hint &#x3D; undefined;
  }

  /**
   * Copy data from the specified source datatation.
   * @param datation The source datation.
   */
  public copyFrom(datation: DatationModel) {
    this.value &#x3D; datation.value;
    this.isCentury &#x3D; datation.isCentury;
    this.isSpan &#x3D; datation.isSpan;
    this.isApproximate &#x3D; datation.isApproximate;
    this.isDubious &#x3D; datation.isDubious;
    this.day &#x3D; datation.day;
    this.month &#x3D; datation.month;
    this.hint &#x3D; datation.hint? datation.hint : undefined;
  }

  /**
   * True if this datation is undefined. A datation is undefined when
   * its value is 0. Undefined datations are used as unknown points in a range
   * for termini ante/post.
   */
  public isUndefined(): boolean {
    return !this.value;
  }

  /**
   * Get a sort value from this datation.
   */
  public getSortValue(): number {
    let result: number;

    if (this.isCentury) {
      result &#x3D; this.value * 100 + (this.value &lt; 0 ? 50 : -50);
    } else {
      result &#x3D; this.value;
    }
    if (this.isSpan) {
      result +&#x3D; .5;
    }
    if (this.month &gt; 0 &amp;&amp; this.month &lt;&#x3D; 12) {
      result +&#x3D; this.month / 12;
    }
    if (this.day &gt; 0 &amp;&amp; this.day &lt;&#x3D; 31) {
      result +&#x3D; this.day / (12 * 31);
    }
    return result;
  }

  /**
   * Get the 2-years span end value from this datation.
   * A span year is always represented with its beginning year: e.g. -776/5
	 * is -776 with span, and 56/7 is 56 with span. This method returns the end year
	 * for a span, i.e. in the above samples -775 and 57 respectively. If this datation
	 * is not a span, the function just returns the unique year value.
   */
  public getSpanEnd(): number {
    if (this.isCentury) {
      return 0;
    }
    return this.isSpan ? this.value + 1 : this.value;
  }

  /**
   * Get the century number corresponding this datation.
   * This function returns 0 if the datation is null, or the century number,
   * less than 0 if B.C. The result is based on the century value, if
   * this is a century datation, or on the year, if this is not a century
   * datation (e.g. -5 for 480 B.C., +1 for 31 A.D.).
   */
  public getCentury(): number {
    if (this.value &#x3D;&#x3D;&#x3D; 0) {
      return 0;
    }
    return this.isCentury ?
      this.value :
      Math.trunc(this.value / 100 + (this.value &lt; 0 ? -1 : 1));
  }

  private matchTokenAt(token: string, text: string, index: number): boolean {
    if (index + token.length &gt; text.length) {
      return false;
    }

    for (let i &#x3D; 0; i &lt; token.length; i++) {
      if (token.charAt(i) !&#x3D;&#x3D; text.charAt(i + index)) {
        return false;
      }
    }
    return true;
  }

  private parseFormatString(format: string): string[] {
    if (!format) {
      return [&#x27;G&#x27;];
    }

    // expand macros
    const macros &#x3D; [
      &#x27;ga&#x27;, &#x27;awdwMMMwvwepwpwh&#x27;,
      &#x27;Ga&#x27;, &#x27;awdwMMMwvwepwpwh&#x27;,
      &#x27;gp&#x27;, &#x27;awdwMMMwvweawpwh&#x27;,
      &#x27;Gp&#x27;, &#x27;awdwMMMwvweawpwh&#x27;,
      &#x27;g&#x27;, &#x27;awdwMMMwvwewpwh&#x27;,
      &#x27;G&#x27;, &#x27;AwdwMMMwVwewPwH&#x27;,
      &#x27;i&#x27;, &#x27;awdwMMMwvwpwh&#x27;,
      &#x27;I&#x27;, &#x27;AwdwMMMwVwPwH&#x27;
    ];
    const sb: string[] &#x3D; [];
    let fi &#x3D; 0, matched: boolean;

    while (fi &lt; format.length) {
      matched &#x3D; false;
      for (let mi &#x3D; 0; mi &lt; macros.length; mi +&#x3D; 2) {
        if (this.matchTokenAt(macros[mi], format, fi)) {
          sb.push(macros[mi + 1]);
          fi +&#x3D; macros[mi].length;
          matched &#x3D; true;
          break;
        }
      }
      if (!matched) {
        sb.push(format[fi]);
        fi++;
      }
    }
    format &#x3D; sb.join();

    // split into tokens and literals
    const tokens &#x3D; [
      &#x27;ddd&#x27;, &#x27;MMM&#x27;,
      &#x27;dd&#x27;, &#x27;ea&#x27;, &#x27;ep&#x27;, &#x27;Ea&#x27;, &#x27;Ep&#x27;, &#x27;ga&#x27;, &#x27;Ga&#x27;, &#x27;gp&#x27;, &#x27;Gp&#x27;, &#x27;MM&#x27;
    ];

    fi &#x3D; 0;
    const results: string[] &#x3D; [];

    while (fi &lt; format.length) {
      matched &#x3D; false;
      for (let ti &#x3D; 0; ti &lt; tokens.length; ti++) {
        if (this.matchTokenAt(tokens[ti], format, fi)) {
          results.push(tokens[ti]);
          fi +&#x3D; tokens[ti].length;
          matched &#x3D; true;
          break;
        }
      }
      if (!matched) {
        results.push(format.charAt(fi));
        fi++;
      }
    }

    return results;
  }

  /**
   * Convert this datation to a string.
   * @param format The format string, which can include any of the following:
   * v &#x3D; year or century value, lowercase
   * V &#x3D; year or century value, uppercase
   * c &#x3D; century, lowercase
   * C &#x3D; century, uppercase
   * a or A &#x3D; &#x27;about&#x27; marker when present
   * p or P &#x3D; &#x27;perhaps&#x27; marker when present
   * d &#x3D; day number when present
   * dd &#x3D; 2-digits (0-padded at left) day number when present
   * ddd &#x3D; weekday name when present
   * M &#x3D; month number when present
   * MM &#x3D; 2-digits (0-padded at left) month number when present
   * MMM &#x3D; month name when present
   * e &#x3D; era
   * E &#x3D; era, all uppercase
   * ea &#x3D; era, only if ante Christum natum
   * ep &#x3D; era, only if post Christum natum
   * Ea &#x3D; era all uppercase, only if ante Christum natum
   * Ep &#x3D; era all uppercase, only if post Christum natum
   * h or H &#x3D; hint when present
   * w or W &#x3D; smart whitespace (appended only when left char if any
   * is not a whitespace)
   * s or S &#x3D; sort value
   * g &#x3D; generic: equal to awdwMMMwvwewpwh
   * G &#x3D; generic uppercase: equal to AwdwMMMwVwewPwH
   * ga &#x3D; generic ante Christum: era expressed only when post Christum
   * natum. Equal to awdwMMMwvwepwpwh
   * Ga &#x3D; generic uppercase ante Christum: equal to awdwMMMwvwepwpwh
   * gp &#x3D; generic post Christum: era expressed only when ante Christum
   * natum. Equal to awdwMMMwvweawpwh
   * Gp &#x3D; generic uppercase post Christum: equal to awdwMMMwvweawpwh
   * i &#x3D; generic with implicit (&#x3D;not expressed) era: equal to awdwMMMwvwpwh
   * I &#x3D; generic uppercase with implicit (&#x3D;not expressed) era: equal to
   * AwdwMMMwVwPwH
   * @param options The options.
   */
  public toString(format &#x3D; &#x27;G&#x27;,
    options: DatationFormatOptions &#x3D; DATATION_FORMAT_OPTIONS): string {
    if (this.isUndefined()) {
      return &#x27;&#x27;;
    }
    if (!format) {
      format &#x3D; &#x27;G&#x27;;
    }
    if (!options) {
      options &#x3D; DATATION_FORMAT_OPTIONS;
    }

    const sb: string[] &#x3D; [];
    const tokens &#x3D; this.parseFormatString(format);

    tokens.forEach(token &#x3D;&gt; {
      switch (token) {
        case &#x27;v&#x27;:
        case &#x27;V&#x27;:
          // year or century
          if (this.isCentury) {
            sb.push(token &#x3D;&#x3D;&#x3D; &#x27;v&#x27; ?
              RomanNumber.toRoman(Math.abs(this.value)).toLowerCase() :
              RomanNumber.toRoman(Math.abs(this.value)).toUpperCase());
          } else {
            const year &#x3D; Math.abs(this.value);
            sb.push(year.toString());
            if (this.isSpan) {
              sb.push(&#x60;/${year + (this.value &lt; 0 ? -1 : +1)}&#x60;);
            }
          }
          break;

        case &#x27;c&#x27;:
        case &#x27;C&#x27;:
          const century &#x3D; Math.abs(this.getCentury());
          sb.push(token &#x3D;&#x3D;&#x3D; &#x27;c&#x27; ?
            RomanNumber.toRoman(century).toLowerCase() :
            RomanNumber.toRoman(century).toUpperCase());
          break;

        case &#x27;a&#x27;:
        case &#x27;A&#x27;:
          if (this.isApproximate) {
            sb.push(options.aboutText);
          }
          break;

        case &#x27;p&#x27;:
        case &#x27;P&#x27;:
          if (this.isDubious) {
            sb.push(&#x27;?&#x27;);
          }
          break;

        case &#x27;d&#x27;:
          if (this.day &gt; 0) {
            sb.push(this.day.toString());
          }
          break;
        case &#x27;dd&#x27;:
          if (this.day &gt; 0) {
            sb.push(this.day.toString().padStart(2, &#x27;0&#x27;));
          }
          break;
        case &#x27;ddd&#x27;:
          if (this.day &gt; 0) {
            const date &#x3D; new Date(this.value, this.month, this.day);
            const dow &#x3D; date.getDay();
            sb.push(options.dayNames[dow]);
          }
          break;

        case &#x27;M&#x27;:
          if (this.month &gt; 0) {
            sb.push(this.month.toString());
          }
          break;
        case &#x27;MM&#x27;:
          if (this.month &gt; 0) {
            sb.push(this.month.toString().padStart(2, &#x27;0&#x27;));
          }
          break;
        case &#x27;MMM&#x27;:
          if (this.month &gt; 0) {
            sb.push(options.monthNames[this.month - 1]);
          }
          break;

        case &#x27;e&#x27;:
          sb.push(this.value &lt; 0 ? options.bcText : options.adText);
          break;
        case &#x27;E&#x27;:
          sb.push(this.value &lt; 0 ?
            options.bcText.toUpperCase() :
            options.adText.toUpperCase());
          break;
        case &#x27;ea&#x27;:
          if (this.value &lt; 0) {
            sb.push(options.bcText);
          }
          break;
        case &#x27;ep&#x27;:
          if (this.value &gt; 0) {
            sb.push(options.adText);
          }
          break;

        case &#x27;h&#x27;:
        case &#x27;H&#x27;:
          if (this.hint) {
            sb.push(&#x60; {${this.hint}}&#x60;);
          }
          break;

        case &#x27;w&#x27;:
        case &#x27;W&#x27;:
          if (sb.length &gt; 0) {
            const last &#x3D; sb[sb.length - 1];
            if (!last.endsWith(&#x27; &#x27;)) {
              sb.push(&#x27; &#x27;);
            }
          }
          break;

        case &#x27;s&#x27;:
        case &#x27;S&#x27;:
          sb.push(this.getSortValue().toString());
          break;

        default:
          // literal
          sb.push(token);
          break;
      }
    });
    return sb.join(&#x27;&#x27;).trim().replace(new RegExp(&#x27;\\s+&#x27;, &#x27;g&#x27;), &#x27; &#x27;);
  }
}
</code></pre>
    </div>
</div>


                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'DatationModel.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
